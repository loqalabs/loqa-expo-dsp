<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>5</storyId>
    <title>Add analyzeSpectrum to Public API and Complete Core DSP</title>
    <status>drafted</status>
    <generatedAt>2025-11-20</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-5-add-analyzespectrum-to-public-api-and-complete-core-dsp.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>all four DSP functions fully exported and documented</iWant>
    <soThat>the complete MVP DSP capability is available</soThat>
    <tasks>
- Export analyzeSpectrum from src/index.ts
- Export SpectrumAnalysisOptions and SpectrumResult types
- Update README.md with spectral analysis example
- Verify all four DSP functions exported
- Verify TypeScript compilation
- Add comprehensive JSDoc
    </tasks>
  </story>

  <acceptanceCriteria>
AC1: Given analyzeSpectrum tested, When updating API, Then src/index.ts exports analyzeSpectrum and types
AC2: Given exports added, When checking, Then README.md updated with analyzeSpectrum example
AC3: Given all functions, When reviewing, Then all four DSP functions exported (computeFFT, detectPitch, extractFormants, analyzeSpectrum)
AC4: Given compilation, When building, Then TypeScript produces complete .d.ts definitions
AC5: Given documentation, When reviewing, Then all JSDoc comments comprehensive
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document - API Contracts</title>
        <section>API Contracts - Module Exports</section>
        <snippet>Follow computeFFT, pitch, and formant export patterns. Comprehensive JSDoc. TypeScript .d.ts generation. README examples. All four core DSP functions now complete.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>src/index.ts</path>
        <kind>module</kind>
        <symbol>index</symbol>
        <lines>all</lines>
        <reason>Add analyzeSpectrum exports to complete public API</reason>
      </artifact>
      <artifact>
        <path>README.md</path>
        <kind>documentation</kind>
        <symbol>README</symbol>
        <lines>all</lines>
        <reason>Add spectral analysis usage examples</reason>
      </artifact>
    </code>
    <dependencies>
      <javascript>
        <package name="typescript" version="^5.3.0" type="dev" />
      </javascript>
    </dependencies>
  </artifacts>

  <constraints>
- Follow export patterns from Stories 2.7, 3.6
- JSDoc with @param, @returns, @throws, @example
- README example: spectral analysis with sine wave
- TypeScript compilation must pass
- Depends on Story 4.4 (tests passing)
- Completes Epic 4 - all four core DSP functions operational
- MVP DSP capability complete: FFT, pitch detection, formant extraction, spectral analysis
  </constraints>

  <interfaces>
    <interface>
      <name>Public API Exports</name>
      <kind>TypeScript module exports</kind>
      <signature>
// src/index.ts
export { computeFFT } from './computeFFT';
export { detectPitch } from './detectPitch';
export { extractFormants } from './extractFormants';
export { analyzeSpectrum } from './analyzeSpectrum';
export type {
  FFTOptions, FFTResult,
  PitchDetectionOptions, PitchResult,
  FormantExtractionOptions, FormantsResult,
  SpectrumAnalysisOptions, SpectrumResult
} from './types';
      </signature>
      <path>src/index.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
Verify TypeScript compilation. Check .d.ts exports. Test imports in example app. Verify JSDoc in IDE. Test README examples. Validate all four DSP functions accessible.
    </standards>
    <locations>
Verification via TypeScript compilation and manual testing
    </locations>
    <ideas>
- Run tsc, verify no errors (AC4)
- Check lib/index.d.ts exports all four functions and types (AC1, AC3, AC4)
- Import in example app, verify autocomplete for all functions (AC5)
- Test README examples actually work (AC2)
- Verify JSDoc appears in IDE for all four functions (AC5)
    </ideas>
  </tests>
</story-context>
