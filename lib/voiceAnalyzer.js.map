{"version":3,"file":"voiceAnalyzer.js","sourceRoot":"","sources":["../src/voiceAnalyzer.ts"],"names":[],"mappings":"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","sourcesContent":["// VoiceAnalyzer - Stateful streaming pitch analysis API\nimport LoqaExpoDspModule from './LoqaExpoDspModule';\nimport { NativeModuleError, ValidationError } from './errors';\nimport type {\n  VoiceAnalyzerConfig,\n  VoiceAnalyzerHandle,\n  VoiceAnalyzerResult,\n  PitchResult,\n  PitchTrack,\n} from './types';\nimport { logDebug } from './utils';\nimport { validateSampleRate } from './validation';\n\n/**\n * Creates a new VoiceAnalyzer instance for stateful pitch tracking\n *\n * The VoiceAnalyzer provides HMM-smoothed pitch detection across frames,\n * ideal for analyzing longer audio clips with temporal coherence.\n *\n * Benefits over single-shot detectPitch():\n * - HMM state persistence between frames for smoother pitch tracks\n * - Better accuracy through temporal context\n * - Aggregate statistics (median, mean, std dev) across all frames\n * - Efficient batch processing of large audio clips\n *\n * @param config - VoiceAnalyzer configuration\n * @returns Promise resolving to VoiceAnalyzerHandle\n * @throws ValidationError if config is invalid\n * @throws NativeModuleError if native creation fails\n *\n * @example\n * ```typescript\n * // Create analyzer for 44.1kHz audio\n * const analyzer = await createVoiceAnalyzer({ sampleRate: 44100 });\n *\n * // Analyze a clip\n * const result = await analyzeClip(analyzer, audioSamples);\n * console.log(`Median pitch: ${result.medianPitch} Hz`);\n *\n * // Clean up when done\n * await freeVoiceAnalyzer(analyzer);\n * ```\n */\nexport async function createVoiceAnalyzer(\n  config: VoiceAnalyzerConfig\n): Promise<VoiceAnalyzerHandle> {\n  logDebug('createVoiceAnalyzer called', config);\n\n  // Validate sample rate\n  validateSampleRate(config.sampleRate);\n\n  // Validate frequency range if provided\n  const minFrequency = config.minFrequency ?? 80;\n  const maxFrequency = config.maxFrequency ?? 400;\n\n  if (minFrequency <= 0) {\n    throw new ValidationError('minFrequency must be positive', {\n      minFrequency,\n    });\n  }\n\n  if (maxFrequency <= minFrequency) {\n    throw new ValidationError('maxFrequency must be greater than minFrequency', {\n      minFrequency,\n      maxFrequency,\n    });\n  }\n\n  // Validate frame/hop sizes if provided\n  const frameSize = config.frameSize ?? 2048;\n  const hopSize = config.hopSize ?? frameSize / 4;\n\n  if (frameSize <= 0 || !Number.isInteger(frameSize)) {\n    throw new ValidationError('frameSize must be a positive integer', {\n      frameSize,\n    });\n  }\n\n  if (hopSize <= 0 || !Number.isInteger(hopSize)) {\n    throw new ValidationError('hopSize must be a positive integer', {\n      hopSize,\n    });\n  }\n\n  try {\n    // Build native config\n    const nativeConfig: Record<string, unknown> = {\n      sampleRate: config.sampleRate,\n      minFrequency,\n      maxFrequency,\n      frameSize,\n      hopSize,\n    };\n\n    logDebug('Calling native module to create VoiceAnalyzer', nativeConfig);\n\n    const nativeResult = await LoqaExpoDspModule.createVoiceAnalyzer(nativeConfig);\n\n    logDebug('Native module returned VoiceAnalyzer handle', {\n      id: nativeResult.id,\n      config: nativeResult.config,\n    });\n\n    // Build handle with resolved config\n    const handle: VoiceAnalyzerHandle = {\n      id: nativeResult.id,\n      config: {\n        sampleRate: config.sampleRate,\n        minFrequency,\n        maxFrequency,\n        frameSize,\n        hopSize,\n      },\n    };\n\n    return handle;\n  } catch (error: unknown) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('createVoiceAnalyzer failed', {\n      error: errorMessage,\n      config,\n    });\n\n    throw new NativeModuleError(`Failed to create VoiceAnalyzer: ${errorMessage}`, {\n      originalError: error,\n      config,\n    });\n  }\n}\n\n/**\n * Analyzes an audio clip using the VoiceAnalyzer\n *\n * Processes the entire audio buffer frame-by-frame with HMM smoothing,\n * returning individual frame results plus aggregate statistics.\n *\n * The analyzer maintains internal state between calls, so each call\n * builds on the previous HMM state. Call resetVoiceAnalyzer() to\n * start fresh with a new clip.\n *\n * @param analyzer - VoiceAnalyzerHandle from createVoiceAnalyzer\n * @param audioBuffer - Audio samples to analyze\n * @returns Promise resolving to VoiceAnalyzerResult\n * @throws ValidationError if analyzer handle or buffer is invalid\n * @throws NativeModuleError if native analysis fails\n *\n * @example\n * ```typescript\n * const result = await analyzeClip(analyzer, audioSamples);\n *\n * console.log(`Analyzed ${result.frameCount} frames`);\n * console.log(`Voiced: ${result.voicedFrameCount} frames`);\n * console.log(`Median pitch: ${result.medianPitch} Hz`);\n * console.log(`Mean confidence: ${result.meanConfidence}`);\n *\n * // Access individual frames\n * for (const frame of result.frames) {\n *   if (frame.isVoiced) {\n *     console.log(`${frame.frequency} Hz (conf: ${frame.confidence})`);\n *   }\n * }\n * ```\n */\nexport async function analyzeClip(\n  analyzer: VoiceAnalyzerHandle,\n  audioBuffer: Float32Array | number[]\n): Promise<VoiceAnalyzerResult> {\n  logDebug('analyzeClip called', {\n    analyzerId: analyzer.id,\n    bufferLength: audioBuffer.length,\n    bufferType: audioBuffer instanceof Float32Array ? 'Float32Array' : 'number[]',\n  });\n\n  // Validate analyzer handle\n  if (!analyzer || !analyzer.id) {\n    throw new ValidationError('Invalid analyzer handle', {\n      analyzer,\n    });\n  }\n\n  // Validate buffer\n  if (!audioBuffer || audioBuffer.length === 0) {\n    throw new ValidationError('Audio buffer cannot be empty', {\n      bufferLength: audioBuffer?.length ?? 0,\n    });\n  }\n\n  // Check for invalid values\n  const hasInvalidValues = Array.from(audioBuffer).some((v) => !isFinite(v));\n  if (hasInvalidValues) {\n    throw new ValidationError('Buffer contains NaN or Infinity values', {\n      bufferLength: audioBuffer.length,\n    });\n  }\n\n  // Convert to number[] for React Native bridge\n  const bufferArray: number[] =\n    audioBuffer instanceof Float32Array ? Array.from(audioBuffer) : audioBuffer;\n\n  try {\n    logDebug('Calling native module for clip analysis', {\n      analyzerId: analyzer.id,\n      bufferLength: bufferArray.length,\n    });\n\n    const nativeResult = await LoqaExpoDspModule.analyzeClip(analyzer.id, bufferArray);\n\n    logDebug('Native module returned analysis result', {\n      frameCount: nativeResult.frameCount,\n      voicedFrameCount: nativeResult.voicedFrameCount,\n      medianPitch: nativeResult.medianPitch,\n    });\n\n    // Convert frames to PitchResult[]\n    const frames: PitchResult[] = nativeResult.frames.map(\n      (frame: {\n        frequency: number | null;\n        confidence: number;\n        isVoiced: boolean;\n        voicedProbability: number;\n      }) => ({\n        frequency: frame.frequency,\n        confidence: frame.confidence,\n        isVoiced: frame.isVoiced,\n        voicedProbability: frame.voicedProbability,\n      })\n    );\n\n    const result: VoiceAnalyzerResult = {\n      frames,\n      frameCount: nativeResult.frameCount,\n      voicedFrameCount: nativeResult.voicedFrameCount,\n      medianPitch: nativeResult.medianPitch ?? null,\n      meanPitch: nativeResult.meanPitch ?? null,\n      pitchStdDev: nativeResult.pitchStdDev ?? null,\n      meanConfidence: nativeResult.meanConfidence ?? null,\n      meanVoicedProbability: nativeResult.meanVoicedProbability,\n    };\n\n    logDebug('analyzeClip completed successfully', {\n      frameCount: result.frameCount,\n      voicedFrameCount: result.voicedFrameCount,\n      medianPitch: result.medianPitch,\n    });\n\n    return result;\n  } catch (error: unknown) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('analyzeClip failed', {\n      error: errorMessage,\n      analyzerId: analyzer.id,\n      bufferLength: audioBuffer.length,\n    });\n\n    throw new NativeModuleError(`Clip analysis failed: ${errorMessage}`, {\n      originalError: error,\n      analyzerId: analyzer.id,\n      bufferLength: audioBuffer.length,\n    });\n  }\n}\n\n/**\n * Processes a complete audio buffer with HMM-smoothed Viterbi decoding\n *\n * Unlike analyzeClip() which processes frames independently, this method uses\n * Viterbi decoding to find the globally optimal pitch track across all frames.\n * This significantly reduces octave jump errors (from ~8-12% to ≤3%) and\n * produces smoother pitch contours.\n *\n * Key differences from analyzeClip():\n * - Uses Viterbi decoding for globally optimal pitch track\n * - Octave jump rate reduced from ~8-12% to ≤3%\n * - Always uses pYIN algorithm regardless of config.algorithm\n * - Higher latency (must see entire buffer) but better accuracy\n * - Returns Float32Array for raw data (more memory efficient)\n *\n * Best suited for offline analysis of complete utterances (typically < 60 seconds).\n * For longer recordings, segment into utterances first.\n *\n * @param analyzer - VoiceAnalyzerHandle from createVoiceAnalyzer\n * @param audioBuffer - Complete audio buffer to analyze\n * @returns Promise resolving to PitchTrack with optimal pitch estimates\n * @throws ValidationError if analyzer handle or buffer is invalid\n * @throws NativeModuleError if native processing fails\n *\n * @example\n * ```typescript\n * const analyzer = await createVoiceAnalyzer({ sampleRate: 44100 });\n * const track = await processBuffer(analyzer, audioSamples);\n *\n * console.log(`Analyzed ${track.frameCount} frames`);\n * console.log(`Median pitch: ${track.medianPitch} Hz`);\n * console.log(`Octave jumps minimized with Viterbi decoding`);\n *\n * // Access raw pitch data\n * for (let i = 0; i < track.pitchTrack.length; i++) {\n *   if (track.pitchTrack[i] > 0) {\n *     console.log(`t=${track.timestamps[i]}s: ${track.pitchTrack[i]} Hz`);\n *   }\n * }\n *\n * await freeVoiceAnalyzer(analyzer);\n * ```\n */\nexport async function processBuffer(\n  analyzer: VoiceAnalyzerHandle,\n  audioBuffer: Float32Array | number[]\n): Promise<PitchTrack> {\n  logDebug('processBuffer called', {\n    analyzerId: analyzer.id,\n    bufferLength: audioBuffer.length,\n    bufferType: audioBuffer instanceof Float32Array ? 'Float32Array' : 'number[]',\n  });\n\n  // Validate analyzer handle\n  if (!analyzer || !analyzer.id) {\n    throw new ValidationError('Invalid analyzer handle', {\n      analyzer,\n    });\n  }\n\n  // Validate buffer\n  if (!audioBuffer || audioBuffer.length === 0) {\n    throw new ValidationError('Audio buffer cannot be empty', {\n      bufferLength: audioBuffer?.length ?? 0,\n    });\n  }\n\n  // Check for invalid values\n  const hasInvalidValues = Array.from(audioBuffer).some((v) => !isFinite(v));\n  if (hasInvalidValues) {\n    throw new ValidationError('Buffer contains NaN or Infinity values', {\n      bufferLength: audioBuffer.length,\n    });\n  }\n\n  // Convert to number[] for React Native bridge\n  const bufferArray: number[] =\n    audioBuffer instanceof Float32Array ? Array.from(audioBuffer) : audioBuffer;\n\n  try {\n    logDebug('Calling native module for buffer processing with Viterbi decoding', {\n      analyzerId: analyzer.id,\n      bufferLength: bufferArray.length,\n    });\n\n    const nativeResult = await LoqaExpoDspModule.processBuffer(analyzer.id, bufferArray);\n\n    logDebug('Native module returned pitch track', {\n      frameCount: nativeResult.frameCount,\n      voicedFrameCount: nativeResult.voicedFrameCount,\n      medianPitch: nativeResult.medianPitch,\n    });\n\n    // Convert native arrays to Float32Array for memory efficiency\n    const result: PitchTrack = {\n      pitchTrack: new Float32Array(nativeResult.pitchTrack),\n      voicedProbabilities: new Float32Array(nativeResult.voicedProbabilities),\n      timestamps: new Float32Array(nativeResult.timestamps),\n      frameCount: nativeResult.frameCount,\n      voicedFrameCount: nativeResult.voicedFrameCount,\n      medianPitch: nativeResult.medianPitch ?? null,\n      meanPitch: nativeResult.meanPitch ?? null,\n    };\n\n    logDebug('processBuffer completed successfully', {\n      frameCount: result.frameCount,\n      voicedFrameCount: result.voicedFrameCount,\n      medianPitch: result.medianPitch,\n    });\n\n    return result;\n  } catch (error: unknown) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('processBuffer failed', {\n      error: errorMessage,\n      analyzerId: analyzer.id,\n      bufferLength: audioBuffer.length,\n    });\n\n    throw new NativeModuleError(`Buffer processing failed: ${errorMessage}`, {\n      originalError: error,\n      analyzerId: analyzer.id,\n      bufferLength: audioBuffer.length,\n    });\n  }\n}\n\n/**\n * Resets the VoiceAnalyzer state for reuse with new audio\n *\n * Call this when starting analysis of a new, independent audio clip.\n * This clears the HMM state so the new clip is analyzed fresh.\n *\n * @param analyzer - VoiceAnalyzerHandle from createVoiceAnalyzer\n * @throws ValidationError if analyzer handle is invalid\n * @throws NativeModuleError if native reset fails\n *\n * @example\n * ```typescript\n * // Analyze first clip\n * const result1 = await analyzeClip(analyzer, clip1Samples);\n *\n * // Reset for new clip\n * await resetVoiceAnalyzer(analyzer);\n *\n * // Analyze second clip with fresh state\n * const result2 = await analyzeClip(analyzer, clip2Samples);\n * ```\n */\nexport async function resetVoiceAnalyzer(analyzer: VoiceAnalyzerHandle): Promise<void> {\n  logDebug('resetVoiceAnalyzer called', {\n    analyzerId: analyzer.id,\n  });\n\n  // Validate analyzer handle\n  if (!analyzer || !analyzer.id) {\n    throw new ValidationError('Invalid analyzer handle', {\n      analyzer,\n    });\n  }\n\n  try {\n    await LoqaExpoDspModule.resetVoiceAnalyzer(analyzer.id);\n\n    logDebug('resetVoiceAnalyzer completed successfully', {\n      analyzerId: analyzer.id,\n    });\n  } catch (error: unknown) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('resetVoiceAnalyzer failed', {\n      error: errorMessage,\n      analyzerId: analyzer.id,\n    });\n\n    throw new NativeModuleError(`Failed to reset VoiceAnalyzer: ${errorMessage}`, {\n      originalError: error,\n      analyzerId: analyzer.id,\n    });\n  }\n}\n\n/**\n * Frees a VoiceAnalyzer instance and releases native resources\n *\n * Always call this when done with an analyzer to prevent memory leaks.\n * After calling this, the analyzer handle should not be used again.\n *\n * @param analyzer - VoiceAnalyzerHandle from createVoiceAnalyzer\n * @throws ValidationError if analyzer handle is invalid\n * @throws NativeModuleError if native free fails\n *\n * @example\n * ```typescript\n * const analyzer = await createVoiceAnalyzer({ sampleRate: 44100 });\n * try {\n *   const result = await analyzeClip(analyzer, samples);\n *   // ... use result ...\n * } finally {\n *   await freeVoiceAnalyzer(analyzer);\n * }\n * ```\n */\nexport async function freeVoiceAnalyzer(analyzer: VoiceAnalyzerHandle): Promise<void> {\n  logDebug('freeVoiceAnalyzer called', {\n    analyzerId: analyzer.id,\n  });\n\n  // Validate analyzer handle\n  if (!analyzer || !analyzer.id) {\n    throw new ValidationError('Invalid analyzer handle', {\n      analyzer,\n    });\n  }\n\n  try {\n    await LoqaExpoDspModule.freeVoiceAnalyzer(analyzer.id);\n\n    logDebug('freeVoiceAnalyzer completed successfully', {\n      analyzerId: analyzer.id,\n    });\n  } catch (error: unknown) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('freeVoiceAnalyzer failed', {\n      error: errorMessage,\n      analyzerId: analyzer.id,\n    });\n\n    throw new NativeModuleError(`Failed to free VoiceAnalyzer: ${errorMessage}`, {\n      originalError: error,\n      analyzerId: analyzer.id,\n    });\n  }\n}\n"]}